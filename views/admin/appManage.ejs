

  <div class="row">
    
      <div class="col-3">
            <%- include ('./nav.ejs') %>
      </div>
      <div class="col-9" style="margin-top: 30px;" id="top-col">
        <div><h2>옵션 설정</h2></div>
        

              <div id="button-group"  style="text-align: center;" >
                <button class="btn btn-success" onclick="deleteOption()">선택항목 삭제</button>
                <button class="btn btn-success" onclick="saveOption()">저장</button>
              </div>    
 
        </div>
      </div>
      
    </div>

<script>
  function deleteOption() {
    $('input[type="checkbox"]').each(function (index, item) {
      if ($(item).prop("checked") == true) 
      {
        const label  =  $(item).closest("li").find('label')
        if( $(label).hasClass("new"))
          $(item).closest("li").remove();
        else
        {
          $(item).closest("li").attr("hidden","");
         $(label).addClass(" removed");
        }
    }
    });
  }
  
  function saveOption() { 
    const age = [];
    const price = [];
    const feature = [];
    const category = [];

    
    $('label').each(function (index, item) {
      var label 
      if(item.className.includes('new'))
        label = 'new'
      else if(item.className.includes('edited'))
        label = 'edited'
      else if(item.className.includes('removed'))
        label = 'removed'
      else
        return 1;


      if(item.className.includes('age'))
      age.push({value: item.textContent?.trim() ,label, origin: item.getAttribute('origin')?.trim() })
       else  if(item.className.includes('feature'))
       feature.push({value: item.textContent?.trim() ,label, origin:item.getAttribute('origin')?.trim()})
       else  if(item.className.includes('category'))
       category.push({value: item.textContent?.trim() ,label, origin:item.getAttribute('origin')?.trim()})
      else if(item.className.includes('price'))
      {
        const value = item.textContent?.trim().split("(결제금액: ")[0]
        const retail_price = parseInt(item.textContent?.trim().split("(결제금액: ")[1])
        const dataValue = {value, label, retail_price, origin:item.getAttribute('origin')?.trim()}
        console.log(dataValue)
        price.push(dataValue)
        console.log(price)
      } 
    });
    console.log(price)
 axios({ url: "/admin/cateories", method: "patch", data:{
    age,price,feature,category,
    _csrf:$('#_csrf').val()
  } })
  .then((res) => {
   alert("변경되었습니다.");
   window.location = "/admin/app"
  })
  .catch((e) => {
    alert("실패했습니다.");
    console.log(e.message);
  });

  }

</script>
 <script type="module" src="/javascripts/admin/fillAppManager.js"></script>

